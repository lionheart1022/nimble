			allow_conditional_comments: false,
			special: 'script,noscript',

			comment: function(text) {
				writer.comment(text);
			},

			cdata: function(text) {
				writer.cdata(text);
			},

			text: function(text, raw) {
				writer.text(text, raw);
			},

			start: function(name, attrs, empty) {
				blocked = true;

				if (name == 'script' || name == 'noscript') {
					return;
				}

				for (var i = 0; i < attrs.length; i++) {
					if (attrs[i].name.indexOf('on') === 0) {
						return;
					}

					if (attrs[i].name == 'style') {
						attrs[i].value = editor.dom.serializeStyle(editor.dom.parseStyle(attrs[i].value), name);
					}
				}

				writer.start(name, attrs, empty);
				blocked = false;
			},

			end: function(name) {
				if (blocked) {
					return;
				}

				writer.end(name);
			}
		}, new tinymce.html.Schema({})).parse(html);

		return writer.getContent();
	}

	function updateHtml(html, data, updateAll) {
		var writer = new tinymce.html.Writer();
		var sourceCount = 0, hasImage;

		function setAttributes(attrs, updatedAttrs) {
			var name, i, value, attr;

			for (name in updatedAttrs) {
				value = "" + updatedAttrs[name];

				if (attrs.map[name]) {
					i = attrs.length;
					while (i--) {
						attr = attrs[i];

						if (attr.name == name) {
							if (value) {
								attrs.map[name] = value;
								attr.value = value;
							} else {
								delete attrs.map[name];
								attrs.splice(i, 1);
							}
						}
					}
				} else if (value) {
					attrs.push({
						name: name,
						value: value
					});

					attrs.map[name] = value;
				}
			}
		}

		new tinymce.html.SaxParser({
			validate: false,
			allow_conditional_comments: true,
			special: 'script,noscript',

			comment: function(text) {
				writer.comment(text);
			},

			cdata: function(text) {
				writer.cdata(text);
			},

			text: function(text, raw) {
				writer.text(text, raw);
			},

			start: function(name, attrs, empty) {
				switch (name) {
					case "video":
					case "object":
					case "embed":
					case "img":
					case "iframe":
						setAttributes(attrs, {
							width: data.width,
							height: data.height
						});
						break;
				}

				if (updateAll) {
					switch (name) {
						case "video":
							setAttributes(attrs, {
								poster: data.poster,
								src: ""
							});

							if (data.source2) {
								setAttributes(attrs, {
									src: ""
								});
							}
							break;

						case "iframe":
							setAttributes(attrs, {
								src: data.source1
							});
							break;

						case "source":
							sourceCount++;

							if (sourceCount <= 2) {
								setAttributes(attrs, {
									src: data["source" + sourceCount],
									type: data["source" + sourceCount + "mime"]
								});

								if (!data["source" + sourceCount]) {
									return;
								}
							}
							break;

						case "img":
							if (!data.poster) {
								return;
							}

							hasImage = true;
							break;
					}
				}

				writer.start(name, attrs, empty);
			},

			end: function(name) {
				if (name == "video" && updateAll) {
					for (var index = 1; index <= 2; index++) {
						if (data["source" + index]) {
							var attrs = [];
							attrs.map = {};

							if (sourceCount < index) {
								setAttributes(attrs, {
									src: data["source" + index],
									type: data["source" + index + "mime"]
								});

								writer.start("source", attrs, true);
							}
						}
					}
				}

				if (data.poster && name == "object" && updateAll && !hasImage) {
					var imgAttrs = [];
					imgAttrs.map = {};

					setAttributes(imgAttrs, {
						src: data.poster,
						width: data.width,
						height: data.height
					});

					writer.start("img", imgAttrs, true);
				}

				writer.end(name);
			}
		}, new tinymce.html.Schema({})).parse(html);

		return writer.getContent();
	}

	editor.on('ResolveName', function(e) {
		var name;

		if (e.target.nodeType == 1 && (name = e.target.getAttribute("data-mce-object"))) {
			e.name = name;
		}
	});

	editor.on('preInit', function() {
		// Make sure that any messy HTML is retained inside these
		var specialElements = editor.schema.getSpecialElements();
		tinymce.each('video audio iframe object'.split(' '), function(name) {
			specialElements[name] = new RegExp('<\/' + name + '[^>]*>', 'gi');
		});

		// Allow elements
		//editor.schema.addValidElements('object[id|style|width|height|classid|codebase|*],embed[id|style|width|height|type|src|*],video[*],audio[*]');

		// Set allowFullscreen attribs as boolean
		var boolAttrs = editor.schema.getBoolAttrs();
		tinymce.each('webkitallowfullscreen mozallowfullscreen allowfullscreen'.split(' '), function(name) {
			boolAttrs[name] = {};
		});

		// Converts iframe, video etc into placeholder images
		editor.parser.addNodeFilter('iframe,video,audio,object,embed,script', function(nodes, name) {
			var i = nodes.length, ai, node, placeHolder, attrName, attrValue, attribs, innerHtml;
			var videoScript;

			while (i--) {
				node = nodes[i];
				if (!node.parent) {
					continue;
				}

				if (node.name == 'script') {
					videoScript = getVideoScriptMatch(node.attr('src'));
					if (!videoScript) {
						continue;
					}
				}

				placeHolder = new tinymce.html.Node('img', 1);
				placeHolder.shortEnded = true;

				if (videoScript) {
					if (videoScript.width) {
						node.attr('width', videoScript.width.toString());
					}

					if (videoScript.height) {
						node.attr('height', videoScript.height.toString());
					}
				}

				// Prefix all attributes except width, height and style since we
				// will add these to the placeholder
				attribs = node.attributes;
				ai = attribs.length;
				while (ai--) {
					attrName = attribs[ai].name;
					attrValue = attribs[ai].value;

					if (attrName !== "width" && attrName !== "height" && attrName !== "style") {
						if (attrName == "data" || attrName == "src") {
							attrValue = editor.convertURL(attrValue, attrName);
						}

						placeHolder.attr('data-mce-p-' + attrName, attrValue);
					}
				}

				// Place the inner HTML contents inside an escaped attribute
				// This enables us to copy/paste the fake object
				innerHtml = node.firstChild && node.firstChild.value;
				if (innerHtml) {
					placeHolder.attr("data-mce-html", escape(innerHtml));
					placeHolder.firstChild = null;
				}

				placeHolder.attr({
					width: node.attr('width') || "300",
					height: node.attr('height') || (name == "audio" ? "30" : "150"),
					style: node.attr('style'),
					src: tinymce.Env.transparentSrc,
					"data-mce-object": name,
					"class": "mce-object mce-object-" + name
				});

				node.replace(placeHolder);
			}
		});

		// Replaces placeholder images with real elements for video, object, iframe etc
		editor.serializer.addAttributeFilter('data-mce-object', function(nodes, name) {
			var i = nodes.length, node, realElm, ai, attribs, innerHtml, innerNode, realElmName;

			while (i--) {
				node = nodes[i];
				if (!node.parent) {
					continue;
				}

				realElmName = node.attr(name);
				realElm = new tinymce.html.Node(realElmName, 1);

				// Add width/height to everything but audio
				if (realElmName != "audio" && realElmName != "script") {
					realElm.attr({
						width: node.attr('width'),
						height: node.attr('height')
					});
				}

				realElm.attr({
					style: node.attr('style')
				});

				// Unprefix all placeholder attributes
				attribs = node.attributes;
				ai = attribs.length;
				while (ai--) {
					var attrName = attribs[ai].name;

					if (attrName.indexOf('data-mce-p-') === 0) {
						realElm.attr(attrName.substr(11), attribs[ai].value);
					}
				}

				if (realElmName == "script") {
					realElm.attr('type', 'text/javascript');
				}

				// Inject innerhtml
				innerHtml = node.attr('data-mce-html');
				if (innerHtml) {
					innerNode = new tinymce.html.Node('#text', 3);
					innerNode.raw = true;
					innerNode.value = sanitize(unescape(innerHtml));
					realElm.append(innerNode);
				}

				node.replace(realElm);
			}
		});
	});

	editor.on('ObjectSelected', function(e) {
		var objectType = e.target.getAttribute('data-mce-object');

		if (objectType == "audio" || objectType == "script") {
			e.preventDefault();
		}
	});

	editor.on('objectResized', function(e) {
		var target = e.target, html;

		if (target.getAttribute('data-mce-object')) {
			html = target.getAttribute('data-mce-html');
			if (html) {
				html = unescape(html);
				target.setAttribute('data-mce-html', escape(
					updateHtml(html, {
						width: e.width,
						height: e.height
					})
				));
			}
		}
	});

	editor.addButton('media', {
		tooltip: 'Insert/edit video',
		onclick: showDialog,
		stateSelector: ['img[data-mce-object=video]', 'img[data-mce-object=iframe]']
	});

	editor.addMenuItem('media', {
		icon: 'media',
		text: 'Insert/edit video',
		onclick: showDialog,
		context: 'insert',
		prependToContext: true
	});

	this.showDialog = showDialog;
});
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         CWS
  xܼXT0~gݽ"*6T%`/B5Q ˲.,`K{l{%v&K?g6{{?)g̜9s9-㸒kPŎkfjԱUlhtk3EFׯF5lY=#k6l02VdZ}@F{@+ݐe̶2BOd7	wRM3fdY4CjL7fd#k֨	Lt}vS}fb#fw?}_cuUo77 blK4:͖j	g
"y&kz]`K̲`N& :{wA9Vlj;OS8,>VUV}F}OcӘ]fsgd֬U4m5MV|c%RC*IW[V cLϗ'=!/ޟm|1צ<))-=D0ThG!X*o;:+dvvXЊ
sfUw֣Ϫt~z'A=:?=7Iݤ_-jq^P,?xȧ}uLg&aqG5 ^O6çƄ			o1](݈;wt\xz7'OQnbbڷ[k1?ԹYmuʙ]vU>}z\K1~&Ȍ~NsnFý%zhk=1\7b=GO,_w;0c/OutL}]#lހ	ۏ5{1?4_]]*^n`w[nrM3{ݾQghy֑ɕ6>zqgVwݻ]{jՄ5<ޱ}҄`ܽwΡWGS.uӄ]6qG_mG`ݜ-?˱ʗN.=ʯc9_kzY;ˍѷVkΨn6>"Ae˖ܷ~&馇%ݴA<uḬ障[K.}ʿٛnV/]?{;%ǦWpj֭Ԟt5n]?|㵕<9'=+˳{Oi3'=z=ńqk4}W˜Kbo1=%-m}.B5"mjo2я&.oV캽g2]9qM}Λ5\9՟˳n(`wgu_}ZuW7`zMoxfydA5a}/mً'>R:Gc?dەoTawnI7~vZÛA~ B6Axvs
X
N<yv?k}qTJ«[ғK'8|,?v'799ѻz6/,q=<#5ggYoꉈշ_ޟ)smvUSnlxN7\i+gwo\y()m{7h3M<}YG9v.|v7&5[r?_r|VwάƱ/ZqnEgןYiUzwݻ/ieөKNmjv0ɡݫ>2%IG6RװʁzM[M(H]WM_~ucZpvMzGHTJy:wqw{҅s/.izٳyGkxҸKX=>h{ 8ֱn~xe$枧n^<ߦ?xbo^,:~>rϓpKxB=o<dˡ񳒓<5"91SW6ӎM^@^{og7ig>bwov]HQhyЄ٧{\׹\û1'tJ;R
Jo5:5ϯnp'sJLX>THȡ-yrYdvFn\}2蘝Zpq#O;]u,)_Y=
r=i&L)/~9?Yp+_]+⛹JDL~W3J]yς=}难]ފ[2v۞ڸ6umK={_K'4yg3salUfTÓϋ.6#`>10ia,rh-Ǟ}J<]Ʋ~c}@SktzFz>(b˯1~Uv}W Qy?Ê%/mm2c_j|L*=8^t9^[vA5-3>а٢)WSΰ_
E'Կc+)1J1i['^Ǿ7|^rz^/~޳wzw]Wo|+չG϶[ӱ;pׯl|FvSG?ėjg/?3mM>{S$]{咗1^̋opϺ|>)ߋn\0=o'N6з}=oGg6;X77G7}6xp2/:2P;F?1GuK'K4s=}ѧ|HD~y_nlGNᘸUގW=qlFO^Spb[bzsvʓ7ֿJa13#ϟ9ٳOLj4/w^yk@)/~_g[>+ڵ-o6*~v7׻Ionߜ޻/.T<c-lQQ0OX=f\ѺkRO^2 SܾKvФFӺDIsjcOo2[7r݄	kV.{]s|8݄4ش
<8j,%kpf@<|p']2֧u맕+zջ`wlMS/xaHC=_ߴD;|K8'xbyíӞ~:k};_>qw٤isM}*Xxdf+&#^&5ջ׈V=\_pWe+<XyL={ZAٯ}ۚ#Uel:]~(yM`0y(ݽv#)O&<];[:֞yfVۓv=hfRW(qύjroZo3kӺ7K]nS[K4Ӽ'Nxy`杘qٽSG05)=6roo
M*2Z5ݫ|Cm[0ׇlyn2.=|k-?kZzC{tbDٷ][ۍ+P%;[ᵻ=jJ7oқ+%aMQ~zI5^I
>zcƥ>}fBi[تW;|R~pݯ5^>رuRЈM~K0$1\s,}qz~=hug$,{a;;-~YS:6]zصJ;A;_M0m\r߯-:t}oUқ_>Ygm_N2K^-=uP3N$8hӶC5{mח4"??7.,87X91a]5kDU5fliM*vJޠb,z={jIkR15';ۖQ1%-ܤb-k6Zz!_bh-IE|ƀ=YVMz̲daP>nڬ990DݨAX'S
}jF}S KZ/?bɖW[ajV5ج&+Ų ibsjj4dSs0:GmikqVzC6e3\tˋr ֑e4]SML$Rm 9Nd)#YQd\kF9(e*lWE0[i)?[:BZȺ(F}}ڤ,[,ݞ,S疍zEERqfGY1q	{LƬzd?^"}%m	-nݏz裻X;X?!~l'E$Tӳ:~D>|L%^~GW/hދ[*ʲ-FUi7UtQtDr=ꭖЋ3{lEea8XLKFs6=".nIKum(:<* {=<Fk3CX6K蚮D:Y7l cM7kM臭YTYAd)Yi+8\^Tcdk뱙>}tE|oۭ4/$qMt9H\\nԇx!o>h>z]fZ`ޣl55ZH0AmJ_vjupP&13x3/hhs)Kni[Ckugg<,ijIAدl,qߖN5`rI^^7f'H8$0Qfe_~ŎU-,Vlf>'JjHʀ^Ocp:\IO5f$=teGLi5ʢY;~ !`zYq&[1` aIX-JD{:d2Y]6B$ri|vmUl`p=WbV;=pBzn%&HRNvc`$dfYKz؂wP$Z4NcB%%F1-בvƬVC4*%CZv+`Er;[z;aVJ/3lBDn2ӕl1'ϴa\Y_G&֢}5
pI/Ìf;Ld*QdY4q3c1),lρF,#lJ<})iilZĮ2\$ll'eXfV)+ a5ȩz=6UV9v1ۯŀl#PVt('b+MΝlTFpn
)KRdۤZ"~-'%Kں飣>o-Z]ʒ_!is,}?1#>`6fGee_(WH{Nϛ'lSHt<]GWE-	Lo4eL%-k5L}cfNM+ȁ]	#f-vI$βRD[[Z1MfʞH.Bnm~@"ȋntV	Ǖ_Qo2*v
Ds8
>*B-:icAi ;~Ef"dCb.\WwKiwxOxkv!,Y!x|3ƴcpɝ[K:5C!ըާ5&	*nU/}=eDG[^һ*`2D|rHÄ2ϲ4*D褼	;eJETlަT*$\8=ΰ4z>1|[p;|2=ETFkqvtUp:5.tDT,+:$#D[O0h=Pۘ&W+Ai_0N~:1F,t=
p4rՔq+Q.gWKʭ>x]=/JHW^KTN`лջBwv+bJ%AVnʲe)t33siROMbVާAE" SÜc|V6؈=AvoT0BQ)u<'Kē%ݪHg>EC󠛅4U~Jm[uN{|;cٖ棍S  s*)^ì7{]R0)a8=%٨dC{[*ˁ
5 G޳Zp*nRdXu	h -I2,`T{+!9YNLgUb.j̕zo=Pe	xtؒV[ψ~\+*\92q3V񋘎	q>ujԬUf4l|!af_^<ܬNHIL1&UW=r;xiTFwѲm\ϔ b!SBTbUuk1&!AjukB׶S;&}6i:ups]ذ~s{s%!vj6eǘHuA)*e}9 hS%TӼݶD	r)Ř؊ز莉s/Kh*F* ɖ;$		jg7@õ~Tqfݤ7}!Ь#2XpcD9sYLy):$S9 Z2DKF$礂63~Nl@Px([(3Vb!R;no"T :*mcbe"OX+Ice Ƶ3fXh2m3۬)1;HUAEN@(Zuh#-0ITJh6R,zbxUm;Ar8Vpd	p2f=b4K@ElN2t@i^r<8m}𴷍"F% "fX|XV2-~ѭZŴLn _bM, -fRZj`ث2oOTpuPW0X>4Ue ipUDCb9(/c|b't1]/lW-7:'1Pc̦L
\V(^rn@Yj%Fy|ibTo|3-ք\!4s > d%=[Z,r0HJA.cK©g	JhMݥ em9;wiUz%c[0ޒ3S Ú c.,{@Q/jP	fG.K{N)XR]-9=<Ծ Mɲ3Ki 5kZP<Ig[vh}{(;訐r1"1/gH}wp;ǲ<&W(*JWghՂ\RВYEH#,Rb&bK񂘩OҘe2!5}!`ٳL[V"ixז5@0YF(
x=cg U5-Qf>֨Z3=j5ljNI5s5k^c"5=W"-YI#b5g
+ȕ`$cAa#i?!=IH\XI!=B +?mH4ct6A-iM&Y2H`eW45)S3:`hULRt
Wl֑sQҮ-#|mmmۍ2PeeK1YЀ W#WyМL1'6)1x
|s+b*vAPDWy2)	*Ϸxi_Aȶ ޞ([{W泥sm`%5v_*ysvKiruDJ.Xo<2Ec϶dKnNawWr酕\
LdJ%D+*Xmjg>j>_
qPx6bXoR9`upPpHpȒ5e\p]Kv+ٽdBYr<q%gsHbRrT!%c	8IJ@_IKqd*3!	GY9JCѐ49ICh鼌OBCBPC̄,G	Y2V*qŊc$<C9!@DFUNzLEoҴ$ъ-
V-b"2$Y)CZm"Kǹ*'m[]eHҾ.CR*$sM$T%` *RA"EJ>+?QЈB((+.`QVBRHʈHʉByt DY(,UDEUQ&*?y.
5DUHjB-Q][$uDu]Q]OTDuCSQXm"f_n!-Eu+Q#cEukQFTǉxQn+ۉZ';EuG$DQIT!:.D$EUHzXX ҔF4bYAĠbUJ2 ) -A}Š~bP1h4PJZ$}#r4`(0 # F0`,l8L#"O j&$3DPdO$S1;ldHAP*L21 <`P0yD, ,X

x$bzbbU[`-:  6l`+6 ; v mD{ 샦2?'P3!D,'bS <| g 8p"% \
  cEJx~&V{ HJ=J}ߐ{	 ?x/ ^x-;B\*V0`p`4P*lHT6[ }
?
 Q1b:<gPQ;@y.| ,X	`-z X}<7l
` K?B~?Y$p { BK)hp SQ(i3 g pe
+ W~#ר{5B 7nܦߟc܅=  7# OJl|J`_C  ry
0`8  F0s t&.D]&^"SxT $"~:g|0/
v>c ްur!D&FKe\0(+yeRl
Ek mUѼ;RNM6&h`+6 ; v `7/Cls'N8  ([w@ΗVÞA6^yW _W|
D_%+ @IW'~ʉD-(C 7`PV/hGʯ5ʕD$=5ʱFKQL6|rN
pBx)umA~(j6F9pgB0`L׈ʅWEHP.AK2|.y0Y%(Wby%[ :x (oxvF0-08}Qm4!ʭ_6xǠ8v(>@@B<l6$LCPVA"±X$Dv=CB(<GW3 qI"
B/Q¡^4	[?<WJ%#xHQ